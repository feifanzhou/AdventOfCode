defmodule AOC.D03 do
  def part_one do
    number_of_trees_in_path({3, 1})
  end

  def part_two do
    [
      number_of_trees_in_path({1, 1}),
      number_of_trees_in_path({3, 1}),
      number_of_trees_in_path({5, 1}),
      number_of_trees_in_path({7, 1}),
      number_of_trees_in_path({1, 2}),
    ] |> Enum.reduce(fn x, y -> x * y end)
  end

  def number_of_trees_in_path({dx, dy} = move_delta) do
    (1..number_of_moves(move_delta))
    |> Enum.reduce(0, fn i, tree_count ->
      cur_x = i * dx
      wrapped_x = Kernel.rem(cur_x, input_width())
      cur_y = i * dy
      input_line = Enum.at(input(), cur_y, "")
      char_in_line = String.at(input_line, wrapped_x)
      if char_in_line == "#", do: tree_count + 1, else: tree_count
    end)
  end

  defp number_of_moves({_dx, dy}) do
    Kernel.ceil(input_height() / dy)
  end

  defp input_height do
    length(input())
  end

  defp input_width do
    String.length(hd(input()))
  end

  @input [
    "...#..............#.#....#..#..",
    "...#..#..#..............#..#...",
    "....#.#.......#............#...",
    "..##.....##.........#........##",
    "...#...........#...##.#...#.##.",
    "..#.#...#....#.....#........#..",
    "....##.###.....#..#.......#....",
    ".#..##...#.....#......#..#.....",
    "............##.#...#.#.....#.#.",
    "..........#....#....#.#...#...#",
    "..##....#.#.#......#.........#.",
    "#.#.........#..............##..",
    "....##.##......................",
    "....##..#...........#..........",
    "..#..#.#........##....#......#.",
    "..............#..#....#.....#..",
    ".............#...#.....#...#...",
    ".#...........#..........#...#..",
    ".#......#.......#......#.......",
    "#..#.............#..#....##.###",
    "........#.#...........##.#...#.",
    "......#..#.....##......#.......",
    ".....#.....#....#..............",
    "#...##.#......#......#...#.....",
    "...........................#...",
    "...#....................#.....#",
    "..#.....#...#.....##.....#.....",
    "....................#......#..#",
    ".......#.....##......##....#...",
    "#........##...#.....##..#...#..",
    "........#..#.#......#..###..#.#",
    "##.....#.............#.#....#..",
    "..#.................#....######",
    ".#.#..#.....#.#..........#.#...",
    ".........#....#...#............",
    "........#..#.....#.............",
    "............#.#.............##.",
    "...#....#..#......#............",
    ".##....#.....#...#.#...........",
    "..#..............#...........##",
    ".....#.#.##...#................",
    "..........#..#.#..........##..#",
    "..#....#...#...#.....######....",
    "....#.#..#........#....#.###...",
    ".......................#.......",
    "..#.....#.##................#..",
    ".....#......#..#.....#........#",
    ".#...###.......#.#.........#..#",
    "............#..................",
    "..#.........##.........##......",
    "#...........#.#.......###.#....",
    ".#...#.....#.........###.....#.",
    ".#............#........#..#....",
    "...##.#......##................",
    "........#...#...#...#..........",
    ".......#.##......##.#..........",
    "....##.......#..#....#....#....",
    "......#.........###........#...",
    "#....#....####....##......#....",
    "......................#....#.#.",
    "...#.#.#....#.#...#...#......#.",
    "......#.....##.#...........###.",
    "#........#.........##......#.#.",
    "....##.....#.....#..#..........",
    "......#...#...#.........#...##.",
    "..#........#..................#",
    ".........#..##.#..#..#...#.#..#",
    ".....#.....#...#.....###.....##",
    ".............#....#...#........",
    "..........#.#.#...#..#...#....#",
    "#...............##.......#.....",
    "#...#.............#..#...#....#",
    "..#...#...##...##...#..#.......",
    "..#..#........#.#...........#..",
    ".....#.....#..................#",
    "....#....##....###..###...##...",
    "..#......###.........##....#.##",
    ".......#.##...#.......#..#.....",
    "...#.#.#.#.....##..#..#........",
    "................##....#.#......",
    "..#...#...#...#.....##.#...#..#",
    "..#..#.....#..##....#....#.....",
    ".###...#......#........#.....##",
    "##......#..#........#..........",
    "....#...#..#....##..#......####",
    ".#.....##....#..........#......",
    ".#...#....#.........#...#....#.",
    ".....#..#.#..#......#..##....#.",
    "...#.##...#...#........#......#",
    ".#..#...#.#..#.........#...#...",
    "#....#......##.....#.......#...",
    "..##............##..#.#.#...#..",
    "##.......#.......##............",
    "#......#.##........#...#...#...",
    ".#.#.......##.........#..#.#...",
    ".............##.#........#.....",
    ".#..#...###...#..#.............",
    ".....#...#..#....#.......#.....",
    "#.#.........#.#.#...#...#.#....",
    ".....#.......#.##.##...#....#..",
    ".#.##..#.....#...#.#.#.#.#..#..",
    "..........#...................#",
    ".....#.#.#...##.........#..#..#",
    ".#..#....##......#...#.........",
    ".##......#......#...#........#.",
    ".....##.#......#............#.#",
    ".#.....##..#...........##......",
    ".....#......#.......##....#....",
    "..#..##..........#.#..........#",
    "#.#.......##..#..##.#....#.....",
    ".......#..#.#.......##......#.#",
    "....#...##...#..............#..",
    ".....#.........#......#...##...",
    "#.........#........##..#.....#.",
    ".#.#..#.....##.......#......#..",
    "........#..#....#.....###..#...",
    "#.#..#.#..........#............",
    "..#......##..#....#.........#..",
    "#..............................",
    ".......#............#..#..#.#..",
    ".#.....#.#....#..#.##.#........",
    ".......#.###.#........##.#..#..",
    "..............#....#.....##.#..",
    "#..............#....#.###......",
    ".#..#..#...###............#...#",
    ".#.##...#....#..#...#...#......",
    "......##..#..#......#..#....#..",
    ".........#.......##............",
    "...........##...#..#....####...",
    ".#..................#..........",
    "#...#..#..................#....",
    "..............#.....##.....#...",
    "..#.#..#...##..#.....#.....#..#",
    "....#....#.#.........#.....#...",
    ".#.......#...#....#...#.#..#..#",
    "#.........##.....##.......#...#",
    "#..#............#....#........#",
    "..........##...#......#....#...",
    ".......#..##...............#...",
    "#............#.#.#.....#.......",
    ".#........##...#...............",
    "..##....#.....#..#.##.#......#.",
    ".#...#.............#...#.....#.",
    "...##....#.......#......#.#..#.",
    "#......................#..#.##.",
    "...#..........#..#.........#...",
    "..#......#.......#.#....#......",
    "....#............#...#......#..",
    ".....#..#..##...#...#.........#",
    ".....#......#....#....#........",
    ".............#..#..........#...",
    "....#..............#.....#.#...",
    "....#.................#.#...#.#",
    ".........#.#...........###.#.##",
    "#...........#..##.#....#.##.#..",
    "#.#.....#......................",
    "##.#.........#....##.#.#..#.#..",
    "#..........#.#.#.#.#..#..##..#.",
    "..#...#..###.........#......#..",
    ".....#......#..#.#............#",
    "...........#...#.#.#.###....#..",
    "#....#..#.......##.#.......##..",
    "..............#.....##.#.......",
    ".#.....#.#..#.........#.#.#..#.",
    "..#..#..#..#................#..",
    "...........#..#.#...#.........#",
    ".#..#..#...#........#...#.#..#.",
    "...#.#..#......#..#............",
    "........#......##.....#....#...",
    "#...#......##.#.#..............",
    ".#........................#....",
    "#.#.....#.##.....#..#.#........",
    "#..........##.#.......#....#..#",
    "#...#..#..#.....#....#....#....",
    "#...........#..#.#....##.##....",
    "##......#..#........#.......##.",
    "#........#..#...#..........#...",
    "...#...#......##....#.#........",
    "...##..#..#.##....#...#........",
    "#.#..#....#...#........#.......",
    "..........#.......#..........#.",
    "......##...#....###...#....#...",
    "........#..#.....#......#......",
    "....#.........##...#..##......#",
    "....#...........#.#..#.#.#.#..#",
    "..#......#..#......#........#.#",
    "#..#....#.....#.............#..",
    "............................#..",
    "#...#.#.....#...#....#....#....",
    "........#...#...#...#...#......",
    ".###........#....#.##.....##.#.",
    ".........#.....#..........#....",
    ".#.........#....##.#.....#.....",
    "#..#....................##.#...",
    "..##.#.............#....#.#....",
    "..#.#........#............##.#.",
    "#........#...##.....#...#.....#",
    ".........#.#..........#....#..#",
    "...###.#..#.#......#.#.....#...",
    "......#.....#..#...#........#..",
    ".......#...#.....#....#....#..#",
    ".#.#........#......##.......#..",
    "#.................###..........",
    "#........#.#..#....#..#........",
    "..##....#.#...##...#...##....#.",
    "...#.#......##...#.....#..#....",
    "#..#........#...###....#.......",
    "##.#....#..#.#..........#......",
    "....#...###...#.....#........#.",
    "..#.#........#....##.#.........",
    "......##.##.................##.",
    ".#....##...#.#..#.#............",
    ".#...###........#......#.......",
    "##..#.#......#..#..#...#.......",
    ".......##..#....#........#....#",
    "......#..........#.............",
    "....##..##..#......#.#.........",
    ".....#....................##...",
    "...###.....#.....#...#.#.##.#..",
    "....#.#..#.......#..#......##..",
    ".......#.#..#.##.#...#......#..",
    "...#.#....#.#...#..##...#...#..",
    "#.##...#....#..#.............#.",
    "...#...#...#.......#..........#",
    ".#..#.............#..##.#......",
    "....#.......#..............#.#.",
    "..................#..#.....##.#",
    ".#...#..#......#..........#...#",
    "..#.#.....#..#....#....#####.#.",
    ".......###.......#....#....#...",
    "......#.#........#...#.........",
    "......#..#.#.#....#.#.#....##..",
    ".#...#.#...##.#......#.........",
    "#....#..##....#.#.......#....#.",
    "..##.#.....#.....#.........#...",
    "......#......#....#....#.....#.",
    "...##.....#....#......#......#.",
    "......#......##............#.#.",
    ".##.#.......#....#...#....#....",
    "....#..#..#...##.......#..#....",
    "....#....#...#.#........#..#...",
    "....#.....#..........#..#......",
    "....#....#...#.....#..##.....#.",
    "##...#..##......#....##..#..#..",
    ".....##.##..............##.....",
    "#.#....#.##..#....#...##.......",
    "..#.....##.....#.....######...#",
    "...#.....#.#.#......#......##.#",
    "...........##.............#....",
    "...##......#..#......#...#.....",
    "....#.##......#..#....#.#..#...",
    ".#..#....#...#..#.....##.......",
    ".....#..#.................#..#.",
    "................#..#...#......#",
    "...##....#.....#..#....##......",
    "....##...............##...#....",
    "......#..........#..##.........",
    ".......###.......#.........#..#",
    "......................#....#.#.",
    "#.#.....#...##............#....",
    "........#......##......#.....#.",
    "...#....#....#.#..##.#..#.#.#..",
    "..#.#....#.##...#..#.....#.#...",
    "............#....#..#.......#..",
    "#...#...#.#......#...##.....#.#",
    "......#....#....#.......#......",
    "....#.......#..........#....#..",
    "........#####........#....#....",
    "......#....##..............#.#.",
    "....#....#.......#.......#.....",
    ".##.#....##....#...............",
    "#.....##........#..#.#...#.#...",
    "...#......##....#..............",
    ".#.....#.....#.......##....##..",
    "#....#..........#.#..#.........",
    "......##..........##.......#...",
    ".##......##.....#.#....#......#",
    "....#......................#...",
    ".#...........###........#...#..",
    "#.#..#..#..#...##.#....#.#..#..",
    "...##...........#.#..........#.",
    "......#.#..#....#....#.........",
    "....#....#.#......#.........##.",
    ".#..#...#...##....#...#......#.",
    "#.#......#...#.#.#...........#.",
    "##.....#..........##....##..##.",
    "...#.#.....#..##........#......",
    "..#........##........#..#......",
    ".......#...............##..#...",
    ".......#.#....#..###...........",
    ".............#........#...#....",
    "#.................#......#..#..",
    "...#....#..#..............#...#",
    ".............#....##....#..##..",
    "#........#..........##...##...#",
    "............#....#.....#.#....#",
    ".....#..............##..#...#..",
    "..#....#......###....#.#...##..",
    "....##......#.....#....#.......",
    ".....#...............#.....#...",
    ".#.....#.....#..............#..",
    "#................#..#..........",
    ".##....#....#.....#............",
    "#.####...#..#..#....#..........",
    "..##........##.....##......#..#",
    "......#.....#...##.........##..",
    "....##..#.....#.#.........#...#",
    ".....##..#....#....#.#...#..#..",
    "...#............#...........#..",
    ".......#.#..#.#.#..#........#.#",
    "....#.#........#.#.#..#...#...#",
    "..#....#....#..#......#........",
    ".#...........................#.",
    ".#..#....####........##......#.",
    ".#.....#..#.#.................#",
    ".#..#...........#...#....#...#.",
    "......##..#........#..#....#...",
    "..#.............#....#........#",
    "#.#..........#.##.......#.#..#.",
    "..#....#...#...............#...",
    "..............#..........#..#..",
    "..#.....#.#.....#...#...#..#...",
    ".........#...###.#...#........#",
  ]

  @spec input() :: [String.t()]
  defp input do
    @input
  end
end
